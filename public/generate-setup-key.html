<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generate Setup Key Hash</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        color: white;
        padding: 20px;
      }
      .container {
        background: rgba(30, 30, 40, 0.9);
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        max-width: 600px;
        width: 100%;
      }
      h1 {
        margin-top: 0;
        color: #64b5f6;
      }
      .info {
        background: rgba(100, 181, 246, 0.1);
        border-left: 4px solid #64b5f6;
        padding: 15px;
        margin-bottom: 25px;
        border-radius: 5px;
        font-size: 14px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        color: #64b5f6;
        font-weight: 500;
      }
      input,
      textarea {
        width: 100%;
        padding: 12px;
        margin-bottom: 20px;
        border: 2px solid rgba(100, 181, 246, 0.3);
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        color: white;
        font-size: 16px;
        box-sizing: border-box;
        font-family: monospace;
      }
      input:focus,
      textarea:focus {
        outline: none;
        border-color: #64b5f6;
        box-shadow: 0 0 15px rgba(100, 181, 246, 0.2);
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 10px;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(100, 181, 246, 0.4);
      }
      .copy-btn {
        background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
      }
      .result {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        word-break: break-all;
      }
      .sql-query {
        background: rgba(0, 0, 0, 0.5);
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #66bb6a;
      }
      .sql-query code {
        display: block;
        white-space: pre-wrap;
        color: #a5d6a7;
        font-family: "Courier New", monospace;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ”‘ Setup Key Hash Generator</h1>

      <div class="info">
        <strong>How to use:</strong><br />
        1. Enter your desired setup key below<br />
        2. Click "Generate Hash"<br />
        3. Copy the SQL query<br />
        4. Run it in your Supabase SQL Editor
      </div>

      <label for="setupKey">Your Setup Key</label>
      <input
        type="text"
        id="setupKey"
        placeholder="e.g., Sigma1234"
        value="Sigma1234"
      />

      <button onclick="generateHash()">Generate Hash</button>

      <div id="output" style="display: none">
        <div class="result">
          <strong>SHA-256 Hash:</strong><br />
          <span id="hashOutput" style="color: #a5d6a7"></span>
        </div>

        <button class="copy-btn" onclick="copySQL()">Copy SQL Query</button>

        <div class="sql-query">
          <strong style="color: #66bb6a">Run this SQL in Supabase:</strong>
          <code id="sqlOutput"></code>
        </div>
      </div>
    </div>

    <script>
      async function generateHash() {
        const setupKey = document.getElementById("setupKey").value;

        if (!setupKey) {
          alert("Please enter a setup key");
          return;
        }

        // Hash the setup key
        const encoder = new TextEncoder();
        const data = encoder.encode(setupKey);
        const hashBuffer = await crypto.subtle.digest("SHA-256", data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hash = hashArray
          .map((b) => b.toString(16).padStart(2, "0"))
          .join("");

        // Display results
        document.getElementById("hashOutput").textContent = hash;

        const sqlQuery = `-- Update setup key in Supabase
UPDATE setup_config 
SET setup_key_hash = '${hash}', 
    is_setup_complete = false 
WHERE id = 1;`;

        document.getElementById("sqlOutput").textContent = sqlQuery;
        document.getElementById("output").style.display = "block";
      }

      function copySQL() {
        const sqlText = document.getElementById("sqlOutput").textContent;
        navigator.clipboard.writeText(sqlText).then(() => {
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = "âœ“ Copied!";
          setTimeout(() => {
            btn.textContent = originalText;
          }, 2000);
        });
      }

      // Generate on page load with default value
      window.addEventListener("load", generateHash);
    </script>
  </body>
</html>
